# PrefVote test suite

PrefVote is designed for multiple programming language implementations using a common test suite. The test suite consists of "black box" test specs used across all languages, plus "white box" unit tests within each language's source code directory. The test harness collects [Test Anything Protocol (TAP)](https://testanything.org/) data from each language's unit tests to report the results.

## Scripts in the test directory

* acr-compare: comparison of voting methods with and without average-choice-rank (ACR) tie-breaking
* blackbox-recalibrate: resets blackbox test data after changes are made to the runtime environment
* run-tests: perform whitebox tests (unit tests) and blackbox test suites
* test-overview: generate a Markdown formatted overview of black-box test data in each test file including results of runs in each of the voting methods

## Progress on the test suite

Numbers in each cell are test cases planned/passed/failed.

<blockquote>
<table>
<thead>
<tr>
<th>language/set</th>
<th>Core</th>
<th>STV</th>
<th>Schulze</th>
<th>RankedPairs</th>
<th>total</th>
</tr>
</thead>
<tbody>
<tr>
<td>Perl whitebox</td>
<td>321/321/0</td>
<td>195/195/0</td>
<td>182/182/0</td>
<td>132/132/0</td>
<td>830/830/0</td>
</tr>
<tr>
<td>Rust whitebox</td>
<td>𝟬</td>
<td>𝟬</td>
<td>𝟬</td>
<td>𝟬</td>
<td>0/0/0</td>
</tr>
<tr>
<td>Perl blackbox</td>
<td>7758/7758/0</td>
<td>8922/8922/0</td>
<td>10279/10279/0</td>
<td>8259/8259/0</td>
<td>35218/35218/0</td>
</tr>
<tr>
<td>Rust blackbox</td>
<td>𝟬</td>
<td>𝟬</td>
<td>𝟬</td>
<td>𝟬</td>
<td>0/0/0</td>
</tr>
<tr>
<td>total</td>
<td>8079/8079/0</td>
<td>9117/9117/0</td>
<td>10461/10461/0</td>
<td>8391/8391/0</td>
<td>36048/36048/0</td>
</tr>
</tbody>
</table>
</blockquote>

## Black-box test data files

Randomly-generated black-box test data files and their run results for each voting method can be found in these overview files (generated by the test-overview script, which also calls acr-compare and vote-count).

[001-rcv-test.yaml](inputs/100-rcv-test/001-rcv-test.md) [002-rcv-test.yaml](inputs/100-rcv-test/002-rcv-test.md) [003-rcv-test.yaml](inputs/100-rcv-test/003-rcv-test.md) [004-rcv-test.yaml](inputs/100-rcv-test/004-rcv-test.md) [005-rcv-test.yaml](inputs/100-rcv-test/005-rcv-test.md) [006-rcv-test.yaml](inputs/100-rcv-test/006-rcv-test.md)

Column headings in result overviews:
* **choice**: name of voting choice (fictitious candidates used in black-box data)
* **avg choice rank**: floating point numbers for average ballot position ranking of each choice, followed in parentheses with the integer totals for the total places and total occurrences which were divided to compute it
* **Core**: PrefVote::Core ranking - these are always in order of i-n since the ACR comparison is ordered relative to Core
* **STV**: PrefVote::STV result place 1-n with/without (slash between them) using ACR/Core for tie-breaking
* **Schulze**: PrefVote::Schulze result place 1-n with/without (slash between them) using ACR/Core for tie-breaking
* **RankedPairs**: PrefVote::RankedPairs result place 1-n with/without (slash between them) using ACR/Core for tie-breaking
* **Copeland**: as an estimate of the Condorcet results, the Copeland result order is shown, with the Copeland score in parentheses (Copeland score is the total pairwise races against other candidates won by a candidate)
